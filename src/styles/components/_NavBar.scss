@use "sass:color";

/* ---------- Variables ---------- */
$primary-blue: #009ee0;
$secondary-blue: #1567db;
$white: #fff;

/* ---------- Hauteur nav partagée ---------- */
:root { --nav-h: 4.5rem; }

/* ---------- Animations ---------- */
@keyframes fadeOpacity { from { opacity:0; } to { opacity:1; } }
@keyframes waveBase { from { stroke-dashoffset:64; opacity:.2; } 70% { opacity:1; } to { stroke-dashoffset:0; opacity:1; } }

/* ---------- Helpers ---------- */
@mixin flex-center { display:flex; align-items:center; justify-content:center; }
@mixin wave-animation { stroke-dasharray:64; stroke-dashoffset:0; opacity:1; }

/* ---------- Barre de navigation ---------- */
.navbar{
  position: fixed;
  inset: 0 0 auto 0;
  z-index: 50;
  min-height: var(--nav-h);
  background: rgba($white,.8);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border-bottom: 1px solid rgba($primary-blue,.2);
  box-shadow: 0 1px 3px rgba(0,0,0,.1);
  transition: background .3s, border-color .3s, box-shadow .3s;
  overflow-x: hidden; /* empêche tout débordement horizontal */
  width: 100%;       /* pas de 100vw -> évite le scroll latéral sur mobile */
  box-sizing: border-box;
}

/* ---------- Mobile : bouton centré (fermé) ---------- */
.picker-mobile-center{
  position:absolute;
  left:50%; top:50%; transform:translate(-50%,-50%);
  @include flex-center;
  flex-direction:column;
  width:100%;
  min-width:min(150px,40vw);
  max-width:min(270px,70vw);
  z-index:22;
}
.picker-closed-button{
  @include flex-center;
  flex-direction:column;
  background:none; border:none;
  padding:.5rem 1rem .1rem;
  width:100%;
  cursor:pointer;
  transition:transform .2s;
  -webkit-tap-highlight-color:transparent;
  &:active{ transform:scale(.98); }
}
.picker-active-label{
  font-family:'NunitoVariable','Quicksand',sans-serif;
  font-size:clamp(1.1rem,4.7vw,1.22rem);
  font-weight:800;
  color:$primary-blue;
  text-align:center;
  user-select:none;
  margin-bottom:-2px;
  line-height:1.2;
  transition:color .18s;
  z-index:2;
}
.picker-wave{ display:block; width:90px; height:12px; margin:0 auto 4px; pointer-events:none; }

/* ---------- Petite flèche sous la nav (fermé) ---------- */
.picker-arrow-absolute{
  position:absolute;
  left:50%; top:calc(100% - 7px); transform:translateX(-50%);
  @include flex-center;
  width:40px; height:30px;
  background:none; border:none;
  padding:0; margin:0;
  z-index:40;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  transition:filter .14s, transform .14s;
  &:hover svg path{ filter:brightness(1.15); }
  &:active{ filter:brightness(.93); transform:translateX(-50%) scale(.95); }
  svg{ transition:transform .2s; }
  &:hover svg{ transform:translateY(2px); }
}

/* ---------- Overlay (ouvert) ---------- */
.picker-overlay{
  position:fixed; inset:0;
  z-index:999;
  background:rgba(0,0,0,.22);
  animation:fadeOpacity .22s ease;
  overscroll-behavior:contain;
}

/* ---------- Modale roulette (ouvert) ---------- */
.picker-roulette-modal{
  position:fixed; inset:0;
  z-index:1000;
  display:grid; grid-template-rows: var(--nav-h) 1fr;
  align-items:start; justify-items:center;
  background:rgba($white,.96);
  backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  animation:fadeOpacity .28s cubic-bezier(.44,.95,.6,1.15);
  overscroll-behavior:contain;
}

/* ---------- Liste/roulette ---------- */
.picker-roulette-list{
  width:min(92vw,420px);
  max-height:min(70vh, 56px * 5);
  margin:0;
  padding:.6rem 0 72px;
  list-style:none;
  overflow-y:auto;

  scroll-snap-type: y proximity;
  touch-action: pan-y;
  -webkit-overflow-scrolling: touch;
  scrollbar-gutter: stable;

  /* cache les barres de scroll */
  scrollbar-width: none;
  &::-webkit-scrollbar{ display:none; }

  /* fondu haut/bas */
  -webkit-mask-image: linear-gradient(180deg, transparent 0%, black 12%, black 88%, transparent 100%);
  mask-image: linear-gradient(180deg, transparent 0%, black 12%, black 88%, transparent 100%);
}

/* ---------- Item ---------- */
.picker-item{
  position: relative;
  @include flex-center;
  text-align:center;
  user-select:none;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
  font-size:1.13rem;
  font-weight:600;
  color:$secondary-blue;
  opacity:.88;
  min-height:54px;
  padding:.7rem 1rem;
  margin:0;
  background:none; border:none;
  border-radius:12px;
  scroll-snap-align:center;
  transition: transform .12s ease, background .18s ease, color .18s ease, opacity .18s ease, scale .18s ease;
  will-change: transform;
  scale:.98;

  &:active, &:focus{
    background-color: color.adjust($primary-blue, $lightness: 44%);
    color:$primary-blue;
    outline:none;
    transform:scale(.985);
  }
  &.active{
    color:$primary-blue;
    font-weight:800;
    opacity:1;
    background:linear-gradient(90deg,#e3f4fb 0%,#fff 100%);
    scale:1.06;
  }
}

/* ---------- Vague interne item actif (mobile) ---------- */
.picker-wave-inside{
  position:absolute;
  left:50%; bottom:6px; transform:translateX(-50%);
  width:76px; height:10px;
  z-index:1;
  pointer-events:none;
}

/* ---------- Flèche du bas (ouvert) ---------- */
.picker-arrow-bottom{
  position: fixed;
  left: 50%; bottom: calc(env(safe-area-inset-bottom) + 12px); transform: translateX(-50%);
  z-index: 1002;
  background:none; border:none;
  cursor:pointer;
  @include flex-center;
  margin:0; padding:.6rem;
  border-radius:50%;
  box-shadow:0 1.5px 10px rgba($primary-blue,.09);
  transition: background .15s, transform .16s cubic-bezier(.44,.95,.6,1.15);
  pointer-events:auto;
  &:hover{ background: color.adjust($primary-blue, $lightness: 47%); }
  &:active{ transform: translateX(-50%) scale(.91); }
}

/* ---------- Helpers d’animation (mobile) ---------- */
.wave-hover-anim{ @include wave-animation; animation:waveBase .42s cubic-bezier(.44,.95,.6,1.15) both; }
.wave-mobile-anim{ @include wave-animation; animation:waveBase .42s cubic-bezier(.44,.95,.6,1.15) both; }
.wave-active-anim{ @include wave-animation; animation:waveBase .52s cubic-bezier(.44,.95,.6,1.15) both; }

/* ========== Vagues sous les liens de la NAVBAR (desktop) ========== */
/* Ajoute .nav-link sur <a> et ce bloc sous le texte :
   <span class="nav-wave">
     <svg class="nav-wave__svg" viewBox="0 0 64 8" fill="none">
       <path class="nav-wave__path" d="M0 4 Q 16 8 32 4 Q 48 0 64 4" />
     </svg>
   </span>
*/

.nav-link {
  position: relative;
  display: inline-flex;
  align-items: center;
  margin: 0;
  padding-bottom: 6px;       /* réserve l’espace de la vague */
  line-height: 1.2;
}

.nav-link .nav-wave {
  position: absolute;
  left: 50%;
  bottom: -14px; /* bien sous le texte */
  width: 80px;
  height: 8px;
  transform: translateX(-50%);
  pointer-events: none;
  overflow: hidden;
  z-index: 1;
}

.nav-link .nav-wave__svg {
  display: block;
  width: 80px;
  height: 8px;
}

.nav-link .nav-wave__path {
  opacity: 0;
  stroke: transparent;
  stroke-width: 2.5;
  stroke-linecap: round;
  stroke-dasharray: 64;
  stroke-dashoffset: 64;
  transition: opacity .3s ease;
}

/* au survol -> vague claire */
.nav-link--hover .nav-wave__path {
  opacity: 1;
  stroke: #b6ecfe;
  animation: navWaveDraw .42s cubic-bezier(.44,.95,.6,1.15) forwards;
}

/* actif -> vague bleue */
.nav-link--active .nav-wave__path {
  opacity: 1;
  stroke: #009ee0;
  animation: navWaveDraw .52s cubic-bezier(.44,.95,.6,1.15) forwards;
}

@keyframes navWaveDraw {
  from { stroke-dashoffset: 64; opacity: .2; }
  70%  { opacity: 1; }
  to   { stroke-dashoffset: 0;  opacity: 1; }
}

/* ---------- Accessibilité ---------- */
@media (prefers-reduced-motion: reduce){
  *,*::before,*::after{
    animation-duration:.001ms !important;
    animation-iteration-count:1 !important;
    transition-duration:.001ms !important;
    scroll-behavior:auto !important;
  }
}

/* ---------- Desktop : on masque la version mobile ---------- */
@media (min-width:1024px){
  .picker-mobile-center,
  .picker-roulette-modal,
  .picker-overlay,
  .picker-arrow-absolute{
    display:none !important;
  }
}
